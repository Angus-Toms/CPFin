#include "example.hpp"

#include <chrono>
#include <iostream>
#include "overlays/sma.hpp"
#include "overlays/bollinger.hpp"
#include "timeseries/ar.hpp"
#include "timeseries/ma.hpp"
#include "timeseries/arma.hpp"

#include "priceseries.hpp"

int main() {
  // // Fetch data
  // const auto ps = PriceSeries::getPriceSeries("AAPL", "2020-01-01", "2020-12-31");

  // // Add indicators
  // ps->addRSI();
  // ps->addBollingerBands();

  // // View and export results 
  // ps->plot();
  // ps->exportCSV("aapl.csv");

  std::vector<double> data = {-0.8447435956353386, -1.8487881143602665, -0.3122293844481998, 0.4372758609079027, 0.12616289260009972, 0.10806800779213088, -1.5137132819957797, -1.3463769743688068, 0.38657501197209876, 0.2721928870518051, 1.5814328905104849, 0.4426885867942091, -0.7905567914128128, -0.7377445983617164, -1.081995432575859, -0.13106142091569073, 0.5898891848961167, 0.6333723819001079, -0.13052706359374552, -1.3892568434231052, -1.0156033185015085, -0.9224344513354052, -1.1228959289688065, 1.4097218518936339, -2.3135587281195766, 0.47290383001833447, -2.098990195465804, 0.9076407753074976, -1.7195011946963001, 1.923496194832385, 0.14347294512100162, -0.7176377068187144, 0.059570864349426156, -0.5096643170833138, -0.5291713216683964, -0.8588493943857416, 1.3831489061885482, -1.4157329454711454, -0.16256901823999537, 0.057319401775174694, -0.29179266128464054, 0.9296592906407943, 1.75529033287281, -0.43016643325390624, -0.4300789598710115, -3.0452418152398426, 0.4150811239408392, -0.697143477474835, 0.2951879350089377, 2.38092495970828, 0.2958347964751765, -1.0654708133264306, -2.713461507985593, -2.464262204143796, -0.3780943544689833, 0.6791036243352032, 1.6254711233068284, 0.703532629479256, -0.12209014060826079, -2.1149437869389813, -0.7672984821460255, 1.0192641374490756, 1.8163242358564895, 0.006536434425305826, 0.20836062416544454, -1.5156126238385124, -1.464405042623582, 0.17265705611686039, 1.3905033244796212, 3.101056533402806, 0.16466040985172878, -0.595931888291927, -1.8723305140466384, 0.17093581650978795, 0.06440529927166927, 0.3377510243858537, 1.5950976172267515, -1.185599376169607, -0.10947539206826529, -0.18485040490507088, 1.9666895628354228, 0.05637442318611985, 1.758271295689577, -3.1126955468233515, -0.3434367459011027, -1.2475566103239424, 2.110095770901868, 1.3248899563084628, 2.7575750164074746, -0.40925856173209074, -1.0573323971955269, -2.8748978269866714, -0.8202953415930034, 0.15936989977078747, 0.7818729845982622, 2.1505690276017697, -0.9366486493664574, -1.8791310123794125, 0.7458774269611281, -0.9425628377930678, 1.1577313675715557, -0.04410083090595085, -1.1978326511384483, -2.9864530148867727, -2.273617563583956, 1.2064712809276479, -0.16787413539428653, 5.005738586934346, 0.4413978967978134, -1.145913390516701, -4.009820232301816, -1.1452784556382873, -0.13501972349815355, 3.413249628685757, 2.2457534874426375, 0.942159127753229, -1.873297246773293, -3.066510828658195, -0.721397272927516, 0.8120296961094021, 2.945381467100247, 0.919564070029246, -3.1477936285064407, -2.88818681305809, -3.052760343352932, -0.42482554223687896, 3.17179717340076, 1.2367954191938466, -0.2540346276065186, -3.093155175693232, -2.7040185835679185, 2.1559158439074553, 1.9164580038570365, 4.725405134400784, -0.20073825006460522, -3.4284104653724645, -4.852205002919111, -2.4138690790610093, 2.9421689956834123, 3.475605275599267, 4.253661019137864, -0.8184001171778716, -4.673060295104429, -1.95311149386262, -0.0650309038997321, 2.4712592536584914, 3.85199036323701, -0.8242172356812264, -1.8382376668819203, -4.294479249145816, -1.4623255738119099, 2.9190495822946887, 3.9840031614836366, -0.12046426116526954, -0.8547962066096269, -4.73045292326564, -1.2212700189639536, -0.11061909303922968, 2.9232744628626732, 2.8671721260254373, 0.07457460759738999, -1.258136341590759, -1.867065838585669, 1.1347343323244476, 3.668281189248237, 2.917622535915369, 2.1253942474343113, -4.269996715359699, -2.1944807364654233, -1.9419497378597954, 0.3147369459433391, 2.9071472292189555, 3.1994249620979467, -0.42551432369019154, -1.4039980647824177, -2.592281367393221, -0.16487211646754524, 1.737703652569068, 3.6622939834178143, 0.46209703922743883, -1.2518969263391226, -3.884061742021267, -2.170772943367653, -1.0017563757640189, 1.2383594222617478, 2.9978170412246636, 1.329344076251459, -0.4391136922588681, -1.8006077558682771, 0.7454415776714629, -0.35818716502016756, 2.2433798230439814, 0.9708405683998399, 1.6365905476291496, -2.5575491954802065, 0.7953402735987222, -0.8721252919599127, 3.2256190164963305, -0.7791332149438374, -0.267356329382642, -2.807501610641778, -0.762151356646314, -2.5511858057772434, 1.5884074892621283, 2.4955763777625584, 2.127106100730117, -0.765967823084998, -0.5646053384874015, -0.9433492233605462, -0.7647211943883969, 1.6549848491723196, 1.8573876768392386, 0.5589665004959362, 0.16981652582708717, -2.183068052179856, -1.4380255617554514, 0.2671380490013968, 0.6080905039295446, 1.6138251200665914, -0.6864060655872601, -1.176421290347866, -2.7069291017813635, -0.672821397008682, -0.3178792946304138, 1.1240250373220513, 2.4301746217908193, -1.196684354537764, 1.4284983968490512, -2.747132990639276, 3.736297626431105, -0.809561300322942, 4.373296164112885, -0.6560278408312544, 1.6572718452827306, -0.4558426394373083, 0.3103321808965745, -0.11842229429592, 1.5343297874323625, -0.16186672058962515, 0.9762504796087159, 0.5374465466472488, 1.969886304232316, 1.7195836069757688, -0.32888577598555757, -0.2687116956564658, -1.993463287620237, -0.07211438755965738, -0.8736729151777141, 1.538447218162431, -0.4750835520882073, 0.391335328356747, -0.39094585321143316, -1.832131234102306, 0.9655388801830656, -0.8382423489620566, 0.4612677674772525, -0.5033613111892585, -1.092475899128388, 1.2298724995264567, -0.6365809769166716, 1.8777353458074186, 1.053700835752558, -0.5129526319457617, 1.3301048378717102, -0.6130899253640313, 0.32010826017547356, 2.3743965189386906, 1.0623525161176204, -0.13540396872895621, -0.09495109929039819, -0.70996742169465, 0.707219019923607, 0.5761298599846763, 2.1847656175572516, 2.113779046404249, -0.977816991730502, -0.3168457282755106, -0.3936838912359508, 0.37833990764699316, 0.8891356984752852, 0.882092297690802, -0.9687055799378891, -2.9397879149824186, -1.0893352986719103, -2.5910232004584035, 1.7478661079465594, 1.9926821727196955, 1.5706440540201607, 1.4075565450304313, -0.8471171769458883, -1.6092772229969725, -0.3856903202731628, 0.33785812210813726, -0.4106691892191703, 0.6534044211617057, 0.3769728591285656, -0.350732984083277, -0.4366160358940462, 0.20789621725907262, 0.9816826451418232, -0.4443076058497521, -0.7096219273398782, 0.1468041140187603, -2.9497588001150152, 0.14679402942931302, -0.43051854539097933, 0.968020802687735, -0.025653528447692753, 2.3324993809925996, 0.04608282299888877, -0.39853096357708956, 0.6887972740469945, -1.3142377834975543, 2.0795736095526625, -1.22512822877178, 1.2921927276906235, -1.2366929266876554, -0.07476098150731164, -1.3356776871631921, -0.6569107015798691, -0.5620300319388328, 0.9872022211864935, -0.9093645898604297, 1.7466302804895002, -1.6280996421272698, 1.6514590747936602, -1.1192516879779042, 0.768494828538234, -0.23999956045266907, 0.3363821771642156, 1.2512126683797722, 0.7895440414996439, -0.05417300341589959, 0.5317584389335337, -3.0198485327203777, -1.0243773345935694, -2.084472935600017, 1.5537490537349496, -0.3745400832895647, 0.6960692681247505, 0.41368702337530616, -1.140764532154947, -0.6522936194691125, -1.699387755395015, -0.1036404893138625, -1.5954356991588299, -2.0936457963024226, -0.4524199545762261, 0.37832181825278743, 1.9102683713661779, 2.204838870340085, 0.7766184438308862, 0.23127805423970849, -2.943750226051574, -0.13009103557611723, -0.09264403140528743, 2.2237303011496445, 0.8531536973845502, -1.7397819203912412, -2.720802820748259, -2.3720280226743884, 1.042946412399146, -0.0883671261535861, 1.2285574206853376, -0.18367371506550392, -2.1172920342288166, -0.9606006761508827, -0.6485489408090367, 3.627762690195613, 1.6280744809819736, -0.18149413460107522, -3.9269106492358388, -3.950443928267967, -1.9059237073922524, 1.8229157025792948, 3.0992210207120685, 2.4281419805921423, -0.5083940511131236, -2.1289016663650635, -2.8357949550673576, 0.3343165244878482, 2.5357721250670027, 1.9154914262987877, 0.3943020001530119, -1.737576131539003, -2.649685107286527, 0.24287917613323562, 0.5601388593458725, 2.017777152215981, -0.5928510442093565, -1.7828001274772913, -4.172383515732039, -1.9229731871196982, 1.532912777924377, 1.4195099791612107, 2.807607213730611, -1.3190742495099266, -2.4266285012219004, -2.6659045659328537, 0.5546267137286088, 1.833914482744, 4.061358211917499, 2.1305815353467645, -0.3659436720360456, -1.9794916018255417, -0.20770296430623736, 0.12511652477256008, 4.170954467683748, 1.0393952953852932, 0.7811844825816104, -1.832089568514645, -3.294642999719847, -1.316688461680798, -0.3756383000712493, 3.082281312411994, -0.4042031900727038, 0.6387530197089015, -1.70298854992893, 1.246017914886497, -0.008056807157698659, 4.629608809478077, -0.2882755423486951, 0.8628926590001857, -2.6436382294557266, -2.142568011570607, -0.8616927755574703, 0.48534419393006756, 1.3418171096582876, -1.3829353329852792, -0.43451474610862795, -2.946527516754453, 0.28062035402955327, -0.41558241626894665, 3.803062259291484, 0.953636831217171, 2.094544373716134, -2.454626838176266, -0.2673662365251865, -1.7567508438618047, 1.6537316868948735, -0.1657281843928054, 0.6409674523336163, 0.6384866257131737, -1.6508074250830675, 2.019218692193421, -0.2199621740630024, 3.4186143656561976, -0.764497079797378, 0.46366868730364386, -0.595457012169057, -0.6902002925562545, 0.8741937128037905, 0.5711419204809294, 0.9417997565521762, -0.295924819397852, -1.6150712751457914, -1.2853895932040547, 0.8645888467364773, 0.738688609060789, 0.2610114632511982, -2.0446350368789243, -0.1569451300284015, -1.8286329389407197, 1.1322325385502756, 0.8127928595284346, 2.334536456824095, 0.04898478777408455, -1.882975648335382, -1.204411578389054, -1.238057608596559, 2.6444063526764774, 0.08647987394205348, 1.1454757873165748, -0.9065667013114505, -1.9297064483228372, -0.7236036212437127, -0.6402433982484294, 2.54492074947867, 1.2739694422948442, 1.5390459168582669, -0.8029445723764063, 1.4674338812523138, -1.715049472072739, 1.6197023480343793, 0.0181217419382399, 0.2358213860786373, -0.05387836849280503, -0.7686156549756122, 0.8244211876630477, 0.4542798588250931, 1.3615562728253359, 0.05991593042538814, 2.6162565577241366, -1.294576171727745, 1.359680696542226, -0.8015710601465601, -0.07102179716938828};
  

  // Learn ARMA model on all but last 10 data points
  std::vector<double> trainData(data.begin(), data.end() - 10);
  ARMA arma(trainData);

  arma.train(3, 3);

  std::vector<double> forecasted = arma.forecast(10);
  for (int i = 0; i < 10; ++i) {
      std::cout << "Forecasted: " << forecasted[i] << std::endl;
      std::cout << "Acutal: " << data[data.size() - 10 + i] << std::endl;
  }


  return 0;
}